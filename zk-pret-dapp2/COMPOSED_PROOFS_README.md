# Composed Proofs for ZK-PRET Compliance System\n\nThis document describes the **Composed Proofs** feature that has been added to your ZK-PRET compliance prover system.\n\n## Overview\n\nComposed Proofs allow you to combine multiple individual compliance verifications into a single, comprehensive proof. Instead of running separate proofs for different compliance requirements, you can now create complex verification workflows that:\n\n- **Combine multiple verifications** (e.g., GLEIF + Corporate Registration + EXIM)\n- **Define dependencies** between proofs (e.g., Corporate Registration depends on GLEIF)\n- **Use different aggregation strategies** (all required, majority, weighted scoring)\n- **Cache results** to avoid re-running expensive proofs\n- **Track execution progress** for complex multi-step verifications\n- **Retry failed components** with configurable backoff strategies\n\n## Key Features\n\n### üîó **Proof Composition**\n- Combine any existing ZK-PRET verification tools\n- Define custom execution workflows\n- Support for both sequential and parallel execution\n\n### üìä **Multiple Aggregation Strategies**\n- **ALL_REQUIRED**: All components must pass\n- **MAJORITY**: Configurable threshold (e.g., 2 out of 3)\n- **WEIGHTED**: Components have different importance weights\n- **CUSTOM**: Define custom aggregation logic\n\n### üîÑ **Dependency Management**\n- Define dependencies between verification components\n- Automatic dependency validation and circular dependency detection\n- Smart execution ordering based on dependency graph\n\n### ‚ö° **Performance Optimization**\n- **Caching**: Store and reuse successful verification results\n- **Parallel Execution**: Run independent verifications simultaneously\n- **Retry Logic**: Automatic retry with exponential backoff\n- **Progress Tracking**: Monitor execution status in real-time\n\n## Built-in Templates\n\nThe system comes with several pre-defined composition templates:\n\n### 1. **Full KYC Compliance** (`full-kyc-compliance`)\nCombines GLEIF, Corporate Registration, and EXIM verifications:\n```json\n{\n  \"templateId\": \"full-kyc-compliance\",\n  \"globalParameters\": {\n    \"companyName\": \"Example Corp\",\n    \"cin\": \"U12345DL2020PLC123456\"\n  }\n}\n```\n\n### 2. **Financial Risk Assessment** (`financial-risk-assessment`)\nCombines Basel3 and Advanced Risk with weighted scoring:\n```json\n{\n  \"templateId\": \"financial-risk-assessment\",\n  \"globalParameters\": {\n    \"threshold\": 0.8,\n    \"actusUrl\": \"https://actus.example.com\"\n  }\n}\n```\n\n### 3. **Business Integrity Check** (`business-integrity-check`)\nCombines BSDI and BPI verifications:\n```json\n{\n  \"templateId\": \"business-integrity-check\",\n  \"globalParameters\": {\n    \"filePath\": \"/path/to/data.json\",\n    \"processId\": \"proc-12345\"\n  }\n}\n```\n\n### 4. **Comprehensive Compliance** (`comprehensive-compliance`)\nCombines all above templates with weighted aggregation:\n```json\n{\n  \"templateId\": \"comprehensive-compliance\",\n  \"globalParameters\": {\n    \"companyName\": \"Example Corp\",\n    \"cin\": \"U12345DL2020PLC123456\",\n    \"threshold\": 0.8\n  }\n}\n```\n\n## API Endpoints\n\n### Get Available Templates\n```http\nGET /api/v1/composed-proofs/templates\n```\n\nResponse:\n```json\n{\n  \"templates\": [...],\n  \"categories\": [\"kyc-compliance\", \"financial-risk\", \"business-integrity\"],\n  \"total\": 4\n}\n```\n\n### Execute Composed Proof\n```http\nPOST /api/v1/composed-proofs/execute\nContent-Type: application/json\n\n{\n  \"templateId\": \"full-kyc-compliance\",\n  \"globalParameters\": {\n    \"companyName\": \"Example Corp\",\n    \"cin\": \"U12345DL2020PLC123456\"\n  },\n  \"executionOptions\": {\n    \"maxParallelism\": 3,\n    \"enableCaching\": true,\n    \"retryPolicy\": {\n      \"maxRetries\": 2,\n      \"backoffStrategy\": \"EXPONENTIAL\",\n      \"backoffDelay\": 1000\n    }\n  }\n}\n```\n\n### Get Execution Status\n```http\nGET /api/v1/composed-proofs/status/{executionId}\n```\n\n### Cache Management\n```http\nGET /api/v1/composed-proofs/cache/stats\nPOST /api/v1/composed-proofs/cache/clear\n```\n\n## Custom Compositions\n\nYou can also create custom compositions without using templates:\n\n```json\n{\n  \"customComposition\": {\n    \"components\": [\n      {\n        \"id\": \"custom-gleif\",\n        \"toolName\": \"get-GLEIF-verification-with-sign\",\n        \"parameters\": {},\n        \"dependencies\": [],\n        \"optional\": false,\n        \"timeout\": 60000,\n        \"cacheKey\": \"gleif-{companyName}\"\n      },\n      {\n        \"id\": \"custom-risk\",\n        \"toolName\": \"get-RiskLiquidityACTUS-Verifier-Test_Basel3_Withsign\",\n        \"parameters\": {},\n        \"dependencies\": [\"custom-gleif\"],\n        \"optional\": false,\n        \"timeout\": 120000\n      }\n    ],\n    \"aggregationLogic\": {\n      \"type\": \"WEIGHTED\",\n      \"weights\": {\n        \"custom-gleif\": 0.7,\n        \"custom-risk\": 0.3\n      },\n      \"threshold\": 0.8\n    }\n  }\n}\n```\n\n## Response Format\n\nComposed proof execution returns detailed results:\n\n```json\n{\n  \"success\": true,\n  \"executionId\": \"exec-123e4567-e89b-12d3-a456-426614174000\",\n  \"requestId\": \"req-123e4567-e89b-12d3-a456-426614174000\",\n  \"overallVerdict\": \"PASS\",\n  \"componentResults\": [\n    {\n      \"componentId\": \"gleif-verification\",\n      \"toolName\": \"get-GLEIF-verification-with-sign\",\n      \"status\": \"PASS\",\n      \"zkProofGenerated\": true,\n      \"executionTime\": \"2.5s\",\n      \"cacheHit\": false,\n      \"timestamp\": \"2024-01-01T12:00:00.000Z\"\n    }\n  ],\n  \"aggregatedResult\": {\n    \"totalComponents\": 3,\n    \"passedComponents\": 3,\n    \"failedComponents\": 0,\n    \"skippedComponents\": 0,\n    \"aggregationScore\": 1.0\n  },\n  \"executionMetrics\": {\n    \"startTime\": \"2024-01-01T12:00:00.000Z\",\n    \"endTime\": \"2024-01-01T12:02:30.000Z\",\n    \"totalExecutionTime\": \"150000ms\",\n    \"parallelExecutions\": 2,\n    \"cacheHits\": 1,\n    \"retries\": 0\n  }\n}\n```\n\n## Integration with Existing System\n\n‚úÖ **Non-Disruptive**: All existing functionality remains unchanged\n‚úÖ **Backward Compatible**: Existing tools work exactly as before\n‚úÖ **Modular**: Each component proof can be executed independently\n‚úÖ **Extensible**: Easy to add new proof types and compositions\n‚úÖ **Reliable**: Robust error handling and recovery mechanisms\n\n## Zero-Knowledge Circuit Integration\n\nThe composed proofs system includes ZK circuits for:\n\n- **Proof Aggregation**: Combine multiple ZK proofs cryptographically\n- **Dependency Validation**: Verify execution order and dependencies\n- **Process Verification**: Ensure correct composition execution\n- **Result Verification**: Validate aggregation logic and scoring\n\nSee `data/COMPOSED/process/bpmnCircuitComposed.ts` for circuit implementations.\n\n## Usage Examples\n\n### Example 1: Simple KYC Check\n```bash\ncurl -X POST http://localhost:3000/api/v1/composed-proofs/execute \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"templateId\": \"full-kyc-compliance\",\n    \"globalParameters\": {\n      \"companyName\": \"Acme Corp\",\n      \"cin\": \"U12345DL2020PLC123456\"\n    }\n  }'\n```\n\n### Example 2: Financial Risk with Custom Threshold\n```bash\ncurl -X POST http://localhost:3000/api/v1/composed-proofs/execute \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"templateId\": \"financial-risk-assessment\",\n    \"globalParameters\": {\n      \"threshold\": 0.75,\n      \"actusUrl\": \"https://custom-actus.example.com\"\n    },\n    \"executionOptions\": {\n      \"maxParallelism\": 2,\n      \"enableCaching\": true\n    }\n  }'\n```\n\n### Example 3: Comprehensive Compliance\n```bash\ncurl -X POST http://localhost:3000/api/v1/composed-proofs/execute \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"templateId\": \"comprehensive-compliance\",\n    \"globalParameters\": {\n      \"companyName\": \"Global Enterprises Ltd\",\n      \"cin\": \"U67890MH2021PLC987654\",\n      \"threshold\": 0.85,\n      \"filePath\": \"/data/compliance.json\"\n    }\n  }'\n```\n\n## Benefits\n\nüöÄ **Efficiency**: Parallel execution and caching reduce total verification time\nüõ°Ô∏è **Reliability**: Retry mechanisms and error handling improve success rates\nüìà **Scalability**: Handle complex multi-step compliance workflows\nüîç **Transparency**: Detailed audit trails and execution metrics\nüí° **Flexibility**: Create custom compositions for specific use cases\nüîí **Security**: Cryptographic proof composition maintains zero-knowledge properties\n\n## Getting Started\n\n1. **List Available Templates**:\n   ```bash\n   curl http://localhost:3000/api/v1/composed-proofs/templates\n   ```\n\n2. **Execute Your First Composed Proof**:\n   ```bash\n   curl -X POST http://localhost:3000/api/v1/composed-proofs/execute \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"templateId\": \"full-kyc-compliance\", \"globalParameters\": {\"companyName\": \"Test Corp\"}}'\n   ```\n\n3. **Monitor Execution Progress**:\n   ```bash\n   curl http://localhost:3000/api/v1/composed-proofs/status/{executionId}\n   ```\n\nThe composed proofs system is now fully integrated into your ZK-PRET compliance prover and ready for use!\n